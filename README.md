# e - ネイピア数の無限桁ジェネレータ

ネイピア数 e = 2.71828... の10進桁を1桁ずつ無限に生成するプログラム。

## 使い方

```bash
# 無限に桁を出力（60桁ごとに改行）
cargo run --release

# 改行なしで連続出力
cargo run --release -- --raw   # または -r

# 先頭1000桁だけ取得
cargo run --release | head -c 1000
```

## アルゴリズム

**ストリーミング線形分数変換（LFT）アルゴリズム**を用いている。
Jeremy Gibbons (2004) "Unbounded Spigot Algorithms for the Digits of Pi" の手法を e に適用したもの。

### eの正則連分数展開

e は以下の正則連分数で表される:

```
e = 2 + 1/(1 + 1/(2 + 1/(1 + 1/(1 + 1/(4 + 1/(1 + 1/(1 + 1/(6 + ...))))))))
```

連分数係数の列として書くと:

```
e = [2; 1, 2, 1, 1, 4, 1, 1, 6, 1, 1, 8, ...]
```

パターンは明確で、`a(0) = 2` の後、`(1, 2k, 1)` が `k = 1, 2, 3, ...` と繰り返される。

### 線形分数変換（メビウス変換）

アルゴリズムの核心は、状態をメビウス変換（2x2行列）として保持することにある:

```
T(x) = (q*x + r) / (s*x + t)

行列表現: [[q, r], [s, t]]
```

初期状態は単位行列 `[[1, 0], [0, 1]]`（恒等変換）。

### 2つの操作

#### 1. 吸収 (absorb)

連分数の次の係数 `a_k` を取り込む操作。
係数 `a_k` に対応する行列 `[[a_k, 1], [1, 0]]` を現在の状態に**右から**掛ける:

```
[[q, r], [s, t]] × [[a_k, 1], [1, 0]] = [[q*a_k + r, q], [s*a_k + t, s]]
```

これは連分数の展開を1段深くすることに対応する。

#### 2. 抽出 (extract) と生成 (produce)

現在の状態から10進桁を取り出せるか判定し、取り出す操作。

**判定条件**: `floor(q/s) == floor((q+r)/(s+t))` が成り立つとき、変換の値域が1つの整数 `d` を含む区間に収まっているため、`d` を次の10進桁として安全に出力できる。

直感的には、連分数の残り部分 `x` がどんな値（`x ∈ [0, ∞)`）であっても `T(x)` の整数部分が `d` で確定する、ということを意味する。
`x = ∞` のとき `T(∞) = q/s`、`x = 0` のとき `T(0) = r/t` であり、
実際の `x` はこの間のどこかにあるため、両端の floor が一致すれば桁が確定する。

桁 `d` を出力した後、状態を更新する。「`d` を出力済み」にするため、10進で1桁分のスケーリングを行う:

```
[[10, -10d], [0, 1]] × [[q, r], [s, t]] = [[10q - 10d*s, 10r - 10d*t], [s, t]]
```

これは `T(x)` から整数部分 `d` を引いて10倍する操作、すなわち `10 * (T(x) - d)` に対応する。

### 全体の流れ

```
初期化: 状態 = 単位行列, k = 0

ループ:
  抽出を試みる
  → 成功: 桁 d を出力し、状態を更新 (produce)
  → 失敗: 次の連分数係数を吸収 (absorb) して再試行
```

吸収を繰り返すことで変換の値域が狭まり、いずれ桁が確定する。確定したら桁を出力して値域を再びスケーリングし、次の桁の確定を待つ。これを無限に繰り返すことで、e の10進桁が1桁ずつストリーミング生成される。

### 計算量

- n桁の生成に O(n^2) 時間（BigInt の桁数が O(n) に成長するため）
- メモリは BigInt 4つ分のみ: O(n)

### 参考文献

- Jeremy Gibbons. "Unbounded Spigot Algorithms for the Digits of Pi." *American Mathematical Monthly*, 113(4), 2006.

## リンク

- http://apod.nasa.gov/htmltest/gifcity/e.5mil
